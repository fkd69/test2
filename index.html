<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸©åº¦ã¨æ¹¿åº¦ã®ã‚°ãƒ©ãƒ•ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ä»˜ãï¼‰</title>
    <script src="https://cdn.canvasjs.com/canvasjs.min.js"></script> <!-- CanvasJSãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
</head>
<body>

    <div id="chartContainer" style="width: 80%; height: 500px; margin: auto;"></div>

    <!-- ğŸ”¹ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆç¯„å›²é¸æŠç”¨ï¼‰ -->
    <input type="range" id="rangeSlider" min="0" max="30" value="30" step="1" style="width: 80%; margin: 20px auto; display: block;">

    <script>
        // ğŸ”¹ Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å…¬é–‹CSV URL
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSY5A0PUveMgm9IHMFKvtNxzb_q1GhZ6pQd5ZIVCeDUUEmi6kpXmcLPrZd3s1VEez-rQzOWdopKBPIl/pub?gid=0&single=true&output=csv';

        let chart; // ã‚°ãƒ©ãƒ•ã®å¤‰æ•°ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å¤‰æ›´æ™‚ã«å†æç”»ç”¨ï¼‰
        let fullData = []; // å…¨ãƒ‡ãƒ¼ã‚¿ä¿æŒç”¨ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ç”¨ï¼‰

        // ğŸ”¹ CSVãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã‚°ãƒ©ãƒ•ã«è¡¨ç¤º
        fetch(sheetUrl)
            .then(response => response.text())
            .then(csvData => {
                const rows = csvData.split("\n").map(row => row.split(",")); // CSVã‚’é…åˆ—ã«å¤‰æ›

                // ğŸ“Œ ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢
                fullData = {
                    temperature: [],
                    humidity: []
                };

                for (let i = 1; i < rows.length; i++) {  // 1è¡Œç›®ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰ã¯ã‚¹ã‚­ãƒƒãƒ—
                    const row = rows[i];

                    // **ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯**
                    if (row.length < 3) continue;  // ç©ºè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—

                    const date = new Date(row[0]);  // æ—¥ä»˜ï¼ˆDateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ï¼‰
                    const temperature = parseFloat(row[1]) || 0;  // æ¸©åº¦ãƒ‡ãƒ¼ã‚¿
                    const humidity = parseFloat(row[2]) || 0;  // æ¹¿åº¦ãƒ‡ãƒ¼ã‚¿

                    fullData.temperature.push({ x: date, y: temperature });
                    fullData.humidity.push({ x: date, y: humidity });
                }

                console.log("æ¸©åº¦ãƒ‡ãƒ¼ã‚¿:", fullData.temperature);
                console.log("æ¹¿åº¦ãƒ‡ãƒ¼ã‚¿:", fullData.humidity);

                // ğŸ”¹ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®æœ€å¤§å€¤ã‚’ãƒ‡ãƒ¼ã‚¿æ•°ã«åˆã‚ã›ã‚‹
                document.getElementById("rangeSlider").max = fullData.temperature.length;
                document.getElementById("rangeSlider").value = fullData.temperature.length;

                drawChart(fullData.temperature.length); // åˆå›è¡¨ç¤º
            })
            .catch(error => console.error("ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:", error));

        // ğŸ”¹ ã‚°ãƒ©ãƒ•ã‚’æç”»ã™ã‚‹é–¢æ•°ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§æ›´æ–°ï¼‰
        function drawChart(range) {
            const temperatureData = fullData.temperature.slice(-range);
            const humidityData = fullData.humidity.slice(-range);

            chart = new CanvasJS.Chart("chartContainer", {
                animationEnabled: true,  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æœ‰åŠ¹
                zoomEnabled: true,       // ğŸ”¹ ã‚ºãƒ¼ãƒ ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ©Ÿèƒ½ï¼‰
                panEnabled: true,        // ğŸ”¹ ãƒ‘ãƒ³ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•ï¼‰
                title: {
                    text: "æ¸©åº¦ã¨æ¹¿åº¦ã®æ¨ç§»"
                },
                axisX: {
                    title: "æ—¥ä»˜",
                    valueFormatString: "YYYY-MM-DD",
                    labelAngle: -50
                },
                axisY: {
                    title: "æ¸©åº¦ (â„ƒ) / æ¹¿åº¦ (%)"
                },
                data: [
                    {
                        type: "spline",
                        name: "æ¸©åº¦ (â„ƒ)",
                        showInLegend: true,
                        markerSize: 5,
                        color: "red",
                        dataPoints: temperatureData
                    },
                    {
                        type: "spline",
                        name: "æ¹¿åº¦ (%)",
                        showInLegend: true,
                        markerSize: 5,
                        color: "blue",
                        dataPoints: humidityData
                    }
                ]
            });

            chart.render();  // ã‚°ãƒ©ãƒ•ã‚’æç”»
        }

        // ğŸ”¹ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById("rangeSlider").addEventListener("input", function() {
            const range = parseInt(this.value);
            drawChart(range);
        });

    </script>

</body>
</html>
